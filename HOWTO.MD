# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ MPPS –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º python. 

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ VSCode, —Ç–∞–∫ –∏ –ª—é–±—É—é Unix —Å–∏—Å—Ç–µ–º—É.

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è VSCode

1. –°–æ–∑–¥–∞—Ç—å —Ä–∞–±–æ—á–µ–µ –ø—Ä–æ—Å—Ç–∞—Ä—Å—Ç–≤–æ
2. –°–æ–∑–¥–∞—Ç—å –≤ —Ä–∞–±–æ—á–µ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ, –∫–æ–º–∞–Ω–¥–æ–π "python -m venv venv"
3. –†–∞–∑—Ä–µ—à–∏—Ç—å –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–≤–µ—Ä—à–µ–ª —Å–∫—Ä–∏–ø—Ç–æ–≤ –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, –≤ –ø–æ–≤–µ—Ä—à–µ–ª–µ –æ—Ç –∞–¥–º–∏–Ω–∞ –∫–æ–º–∞–Ω–¥–æ–π "Set-ExecutionPolicy RemoteSigned" –∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ê
4. –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—á–µ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –∫–æ–º–∞–Ω–¥–æ–π ".\venv\Scripts\Activate.ps1 "
5. –û–±–Ω–æ–≤–∏—Ç—å pip –∫–æ–º–∞–Ω–¥–æ–π "python -m pip install --upgrade pip"
6. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω—É–∂–Ω—ã–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ "pip install pydicom pynetdicom paramiko"
7. –°–æ–∑–¥–∞—Ç—å –ø–∞–π—Ç–æ–Ω —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ mpps, –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—É—Å—Ç—å –±—É–¥–µ—Ç "send_mpps_ncreate.py"
8. –í—Å—Ç–∞–≤–∏—Ç—å –∫–æ–¥ –≤ —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å:

    <details>
        <summary>–ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–¥ send_mpps_ncreate.py</summary>

            ```python
            from pydicom.dataset import Dataset
            from pydicom.uid import generate_uid
            from pynetdicom import AE
            from pynetdicom.sop_class import ModalityPerformedProcedureStep
            import datetime

            # üìÖ –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è
            now = datetime.datetime.now()
            start_date = now.strftime("%Y%m%d")
            start_time = now.strftime("%H%M%S")

            # üîê –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ MPPS UID
            mpps_uid = generate_uid(prefix="2.25.")

            # üì¶ –§–æ—Ä–º–∏—Ä—É–µ–º Dataset –¥–ª—è N-CREATE
            ds = Dataset()
            ds.SOPClassUID = ModalityPerformedProcedureStep
            ds.SOPInstanceUID = mpps_uid
            ds.PerformedProcedureStepID = "MPPS_TEST_" + now.strftime("%H%M%S")
            ds.PerformedProcedureStepStatus = "IN PROGRESS"
            ds.PerformedProcedureStepStartDate = start_date
            ds.PerformedProcedureStepStartTime = start_time
            ds.Modality = "OT"  # –ù–∞–ø—Ä–∏–º–µ—Ä: MG, CT, MR –∏ —Ç.–¥.
            ds.PerformedStationAETitle = "MPPSSCU"
            ds.PerformedStationName = "TEST_STATION"
            ds.StudyInstanceUID = generate_uid(prefix="2.25.")

            # üë§ –î–∞–Ω–Ω—ã–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞
            ds.PatientName = "TEST"
            ds.PatientID = "TEST123"

            # üóìÔ∏è (0040,0270) ScheduledStepAttributesSequence ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π Type 1
            scheduled_step = Dataset()
            scheduled_step.ScheduledStationAETitle = "MPPSSCU"
            scheduled_step.ScheduledProcedureStepStartDate = start_date
            scheduled_step.ScheduledProcedureStepStartTime = start_time
            scheduled_step.ScheduledProcedureStepDescription = "Test MPPS"
            scheduled_step.ScheduledProcedureStepID = "SPSID1234"
            scheduled_step.RequestedProcedureID = "REQID1234"
            scheduled_step.StudyInstanceUID = ds.StudyInstanceUID
            ds.ScheduledStepAttributesSequence = [scheduled_step]

            # üì° –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
            ae = AE(ae_title="MPPSSCU")
            ae.add_requested_context(ModalityPerformedProcedureStep)

            assoc = ae.associate("192.168.32.134", 11112, ae_title="DCM107")

            if assoc.is_established:
                print(f"üì° –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ. –û—Ç–ø—Ä–∞–≤–∫–∞ N-CREATE –¥–ª—è UID:\n‚û°Ô∏è  {mpps_uid}")

                status = assoc.send_n_create(
                    dataset=ds,
                    class_uid=ModalityPerformedProcedureStep,
                    instance_uid=mpps_uid
                )

                status_code, _ = status
                if isinstance(status_code, Dataset):
                    print(f"‚úÖ –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞: Status = 0x{status_code.Status:04x}")
                elif isinstance(status_code, int):
                    print(f"‚úÖ –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞: Status = 0x{status_code:04x}")
                else:
                    print(f"‚ö†Ô∏è –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø –æ—Ç–≤–µ—Ç–∞: {status_code}")

                assoc.release()
            else:
                print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º.")
            ```

	
9. –ò—Å–ø–æ–ª–Ω—è–µ–º —Å–∫—Ä–∏–ø—Ç –∏ –∏—â–µ–º –≤ –ª–æ–≥–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞, —É—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—Ä–æ—Å –≤ –ª–æ–≥–µ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:

    <details>
    <summary>–ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥ —Å–µ—Ä–≤–µ—Ä–∞</summary>

        ```log
        2025-07-10 10:20:35,393 INFO  -> (TCPServer-1-3) [org.dcm4cheri.server.ServerImpl] handle - Socket[addr=/192.168.41.23,port=47795,localport=11112]
        2025-07-10 10:20:35,393 INFO  -> (TCPServer-1-3) [org.dcm4cheri.net.FsmImpl] Socket[addr=/192.168.41.23,port=47795,localport=11112]
        2025-07-10 10:20:35,393 INFO  MPPSSCU->DCM107 (TCPServer-1-3) [org.dcm4cheri.net.FsmImpl] received AAssociateRQ
            appCtxName:	1.2.840.10008.3.1.1.1/DICOM Application Context Name
            implClass:	1.2.826.0.1.3680043.9.3811.3.0.3
            implVersion:	PYNETDICOM_303
            calledAET:	DCM107
            callingAET:	MPPSSCU
            maxPDULen:	16382
            asyncOpsWindow:	
            pc-1:	as=1.2.840.10008.3.1.2.3.3/Modality Performed Procedure Step SOP Class
                ts=1.2.840.10008.1.2/Implicit VR Little Endian
                ts=1.2.840.10008.1.2.1/Explicit VR Little Endian
                ts=1.2.840.10008.1.2.1.99/Deflated Explicit VR Little Endian
                ts=1.2.840.10008.1.2.2/Explicit VR Big Endian
        2025-07-10 10:20:35,395 INFO  MPPSSCU->DCM107 (TCPServer-1-3) [org.dcm4cheri.net.FsmImpl] sending AAssociateAC
            appCtxName:	1.2.840.10008.3.1.1.1/DICOM Application Context Name
            implClass:	1.2.40.0.13.1.1.1
            implVersion:	dcm4che-1.4.33
            calledAET:	DCM107
            callingAET:	MPPSSCU
            maxPDULen:	16352
            asyncOpsWindow:	
            pc-1:	0 - acceptance
                ts=1.2.840.10008.1.2.1/Explicit VR Little Endian
        2025-07-10 10:20:35,435 INFO  MPPSSCU->DCM107 (TCPServer-1-3) [org.dcm4cheri.net.FsmImpl] received [pc-1] 1:N_CREATE_RQ with Dataset
            class:	1.2.840.10008.3.1.2.3.3/Modality Performed Procedure Step SOP Class
            inst:	2.25.4385061255521984359992215834134387840122231812574317535471/?
        2025-07-10 10:20:35,439 INFO  MPPSSCU->DCM107 (TCPServer-1-3) [org.dcm4chex.archive.ejb.entity.PatientBean] Created Patient[pk=433870, pid=TEST123, issuer=null, name=TEST^^^^]
        2025-07-10 10:20:35,522 INFO  MPPSSCU->DCM107 (TCPServer-1-3) [org.dcm4chex.archive.ejb.entity.MPPSBean] Created MPPS[pk=44419, iuid=2.25.47708778590409370161849180212254028873199035993373897800443, status=IN PROGRESS, patient->ejb/Patient:433870]
        2025-07-10 10:20:35,562 INFO  MPPSSCU->DCM107 (TCPServer-1-3) [org.dcm4chex.archive.dcm.mwlscp.MWLFindScpService] No such MWL item[spsid=SPSID1234]
        2025-07-10 10:20:35,563 INFO  MPPSSCU->DCM107 (TCPServer-1-3) [org.dcm4cheri.net.FsmImpl] sending [pc-1] 1:N_CREATE_RSP
            class:	1.2.840.10008.3.1.2.3.3/Modality Performed Procedure Step SOP Class
            inst:	2.25.4385061255521984359992215834134387840122231812574317535471/?
            status:	0
        2025-07-10 10:20:35,568 INFO  MPPSSCU->DCM107 (TCPServer-1-3) [org.dcm4cheri.net.FsmImpl] received A-RELEASE-RQ
        2025-07-10 10:20:35,568 INFO  MPPSSCU->DCM107 (TCPServer-1-3) [org.dcm4cheri.net.FsmImpl] sending A-RELEASE-RP
        2025-07-10 10:20:35,619 INFO  MPPSSCU->DCM107 (TCPServer-1-3) [org.dcm4cheri.net.FsmImpl] closing connection - Socket[addr=/192.168.41.23,port=47795,localport=11112]
        2025-07-10 10:20:35,619 INFO  -> (TCPServer-1-3) [org.dcm4cheri.server.ServerImpl] finished - Socket[addr=/192.168.41.23,port=47795,localport=11112]
        ```

–¢–∞–∫ –∂–µ VSCode –Ω–∞–º —Å–æ–æ–æ–±—â–∏—Ç:

üì° –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ. –û—Ç–ø—Ä–∞–≤–∫–∞ N-CREATE –¥–ª—è UID:
‚û°Ô∏è  2.25.47708778590409370161849180212254028873199035993373897800443
‚úÖ –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞: Status = 0x0000

–ö–æ–¥ 0x0000 –æ–∑–Ω–∞—á–∞–µ—Ç —É—Å–ø–µ—à–Ω–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ mpps —Å—Ç–∞—Ç—É—Å–∞.

10. –î–∞–ª–µ–µ –Ω–∞–º –Ω–∞–¥–æ —Å–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞, —Ç–∞–∫–∂–µ —Å–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª send_mpps_nset_completed.py –∏ –∫–æ–ø–∏—Ä—É–µ–º –≤ –Ω–µ–≥–æ –∫–æ–¥:

    <details>
    <summary>–ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–¥ send_mpps_nset_completed.py</summary>

        ```python
        from pydicom.dataset import Dataset
        from pynetdicom import AE
        from pynetdicom.sop_class import ModalityPerformedProcedureStep
        import sys
        from datetime import datetime

        # üëâ –ü–æ–ª—É—á–µ–Ω–∏–µ UID –∏–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
        if len(sys.argv) != 2:
            print("Usage: python3 send_mpps_nset_completed.py <MPPS_SOP_Instance_UID>")
            sys.exit(1)

        mpps_uid = sys.argv[1]

        # üì¶ –°–æ–∑–¥–∞–Ω–∏–µ Dataset –¥–ª—è N-SET —Å –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ COMPLETED –∏ –≤—Ä–µ–º–µ–Ω–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
        ds = Dataset()
        ds.PerformedProcedureStepStatus = "COMPLETED"

        now = datetime.now()
        ds.PerformedProcedureStepEndDate = now.strftime("%Y%m%d")  # YYYYMMDD
        ds.PerformedProcedureStepEndTime = now.strftime("%H%M%S")  # HHMMSS

        ds.PerformedSeriesSequence = [Dataset()]

        # üì° –ù–∞—Å—Ç—Ä–æ–π–∫–∞ AE –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
        ae = AE(ae_title="MPPSSCU")
        ae.add_requested_context(ModalityPerformedProcedureStep)

        assoc = ae.associate("192.168.32.134", 11112, ae_title="DCM107")

        if assoc.is_established:
            print(f"üîó –°–≤—è–∑—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º N-SET –¥–ª—è UID: {mpps_uid}")

            # –û—Ç–ø—Ä–∞–≤–∫–∞ N-SET
            status = assoc.send_n_set(ds, class_uid=ModalityPerformedProcedureStep, instance_uid=mpps_uid)

            # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞
            status_code, _ = status
            if isinstance(status_code, Dataset):
                print(f"‚úÖ –û—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞: Status = 0x{status_code.Status:04x}")
            elif isinstance(status_code, int):
                print(f"‚úÖ –û—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞: Status = 0x{status_code:04x}")
            else:
                print(f"‚ö†Ô∏è –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø –æ—Ç–≤–µ—Ç–∞: {status_code}")

            assoc.release()
        else:
            print("‚ùå –û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º.")
        ```	
	
11. –ò—Å–ø–æ–ª–Ω—è–µ–º —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Å –∞—Ä–≥—É–º–µ–Ω–æ–º UID –∫–æ—Ç–æ—Ä—ã–π –º—ã –ø–æ–ª—É—á–∏–ª–∏ –Ω–∞ —à–∞–≥–µ –≤—ã—à–µ (–ø—Ä–∏–º–µ—Ä: send_mpps_nset_completed.py 2.25.47708778590409370161849180212254028873199035993373897800443) —Å–º–æ—Ç—Ä–∏–º —Å—Ç–∞—Ç—É—Å –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ mpps –≤ –ë–î –ø–∞–∫—Å–∞:
–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:
üîó –°–≤—è–∑—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º N-SET –¥–ª—è UID: 2.25.47708778590409370161849180212254028873199035993373897800443
‚úÖ –û—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞: Status = 0x0000
–£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –Ω–∞—à –∑–∞–ø—Ä–æ—Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è, –ø—Ä–æ–≤–µ—Ä–∏–º —ç—Ç–æ –≤ –ë–î –ø–∞–∫—Å–∞
(–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ dcm4che —Ç–∏–ø–æ–≤–∞—è —Ç–æ –≤ –±–¥ –ø–æ–ø–∞–¥–∞–µ–º —Ç–∞–∫): 	

- –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è postgres –∫–æ–º–∞–Ω–¥–æ–π "sudo -i -u postgres"
- –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –Ω—É–∂–Ω—É—é –Ω–∞–º –±–¥ "psql pacsdb", —É–∑–Ω–∞—Ç—å –∫ –∫–∞–∫–æ–π –±–¥ –ø–æ–¥–∫–ª—é—á–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –º–æ–∂–Ω–æ –∫–æ–º–∞–Ω–¥–æ–π \c
- –∏—â–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞—à–µ–≥–æ mpps –ø–æ–¥—Ç–µ—Ä–∂–¥–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥–æ–π "SELECT * FROM mpps WHERE mpps_iuid = '2.25.47708778590409370161849180212254028873199035993373897800443';" \\mpps_uid –±–µ—Ä–µ–º –∏–∑ –ª–æ–≥–∞ –≤—ã—à–µ, —Ç–∞–º –æ–Ω –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è iuid
–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: —Å—Ç–∞—Ç—É—Å mpps_status
–ï—Å–ª–∏ —ç—Ç–æ integer, —Ç–æ –∑–Ω–∞—á–µ–Ω–∏—è –º–æ–≥—É—Ç –æ–∑–Ω–∞—á–∞—Ç—å:
0 ‚Äî IN PROGRESS
1 ‚Äî COMPLETED
2 ‚Äî DISCONTINUED 

–ó–∞–ø—Ä–æ—Å –≤ –ë–î —Å–æ–æ–±—â–∏–ª, —á—Ç–æ —Å—Ç–∞—Ç—É—Å –º–æ–µ–≥–æ –ø–æ–¥—Ç–≤–µ–∂–¥–µ–Ω–∏—è mpps = 1, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —É—Å–ø–µ—à–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É.

<details>
<summary>–ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–≤–æ–¥ –∑–∞–ø—Ä–æ—Å–∞</summary>

```sql
pk   | patient_fk | drcode_fk |                            mpps_iuid                             |      pps_start      | station_aet | modality | accession_no | mpps_status |      created_time       |      updated_time       |                                                                                                                                                                                                                                                                                                                                                           mpps_attrs                                                                                                                                                                                                                                                                                                                                                           
-------+------------+-----------+------------------------------------------------------------------+---------------------+-------------+----------+--------------+-------------+-------------------------+-------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
44426 |     433890 |           | 2.25.47708778590409370161849180212254028873199035993373897800443 | 2025-07-10 10:43:58 | MPPSSCU     | OT       |              |           1 | 2025-07-10 10:43:59.311 | 2025-07-10 10:47:45.606 | \x02000000554c04001e0000000200100055491600312e322e3834302e31303030382e312e322e312e3939ad4f416ec2400c1c82d4a6a8489c2a8ebc20b2d7bbd9dddba610092468021bcef4d27ba5f6bb95780969828a5a38d717cb33f68c27c513f6ab29385399d3943111b94cb27e964c9062daf1012a5326d3d692b3d6194f9abc58e29c9df6ec48b152469372ce0a7b4f62bc17b1e2bc75445a4b8a57cc6382aa9961fcabc82c968d359c5b21f6d64ba72c4ee79c6b518a24d74a792666638c38e1dc3bf69a9cb1014552942936751de37c3f0b784ee2f2114d199b436c8a6655bd042c924591429132649902caa4d9dc81498b7101f50dbbbdb056eb805d328f23ccab4dbd2e9b72d139c4ce6172763c9c6d2e3aef49dc026d57a716c7beff5fca01ae5326b8fe7988bf89eeb1ae4668de3e3e67fd49b7ff80b81c21d671b56025ba4306931ed995db1fe4d48e8fe8ead47e9d7b4018dee6b9ddf906
(1 row)
```
</details>    

## UPD:
–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è Ubuntu

1. –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞–∫–µ—Ç—ã "sudo apt update"
2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–∞–π—Ç–æ–Ω –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ –ø–∏–ø "sudo apt install python3-venv python3-pip"
3. –°–æ–∑–¥–∞–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ "python3 -m venv venv-mpps"
4. –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ "source venv-mpps/bin/activate"
5. –£—Å—Ç–∞–Ω–æ–≤–ª–∏–≤–∞–µ–º –Ω—É–∂–Ω—ã–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ "pip install pydicom pynetdicom paramiko"
6. –î–∞–ª–µ–µ –≤—Å–µ –∫–∞–∫ –¥–ª—è VSCode

## UPD:

–í–º–µ—Å—Ç–æ —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ mpps (–ø.7 –∏ –¥–∞–ª–µ–µ) –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç mpps_value_check.py
–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ —É–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É –ü–ê–ö–°, –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º ssh
–î–∞–ª–µ–µ –≤–≤–æ–¥–∏—Ç—Å—è –∏—Å–∫–æ–º—ã–π mpps_iuid
–ü–æ—Å–ª–µ —á–µ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º –ø–∞—Ä–æ–ª–µ–º –ø—Ä–∏–≤–µ–ª–∏–≥–µ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ë–î

–ü–æ –æ–∫–æ–Ω—á–∞–Ω–∏—é –æ—Ç—Ä–∞–±–æ—Ç–∫–∏ —Å–∫—Ä–∏–ø—Ç –æ—Ç–¥–∞—Å—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∞–Ω–Ω–æ–µ –≤ –ë–î –≤ –≤–∏–¥–µ:

0 ‚Äî IN PROGRESS
1 ‚Äî COMPLETED
2 ‚Äî DISCONTINUED

–ü—Ä–∏–º–µ—Ä: ‚úÖ –°—Ç–∞—Ç—É—Å MPPS: COMPLETED (–∫–æ–¥ 1)

–ö–æ–¥ –¥–ª—è mpps_value_check.py

<details>
<summary>–ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–¥ mpps_value_check.py</summary>

```python
import paramiko
import getpass
import time
import re

# –î–∞–Ω–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
host = "YOUR_IP"
port = 22
username = input("–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è SSH: ")
password = getpass.getpass("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å SSH: ")

# –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ mpps_iuid –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
mpps_iuid = input("–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ mpps_iuid: ")

# SQL-–∑–∞–ø—Ä–æ—Å (—Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ç—É—Å)
sql_query = f"psql -d pacsdb -t -A -F',' -c \"SELECT mpps_status FROM mpps WHERE mpps_iuid = '{mpps_iuid}';\""

# –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —á–∏—Å–ª–æ–≤–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
status_map = {"0": "IN PROGRESS", "1": "COMPLETED", "2": "DISCONTINUED"}

try:
    client = paramiko.SSHClient()
    client.set_missing_host_key_policy(paramiko.AutoAddPolicy())
    client.connect(hostname=host, port=port, username=username, password=password)

    channel = client.invoke_shell()
    time.sleep(1)

    # –ü–æ–≤—ã—à–µ–Ω–∏–µ –¥–æ postgres
    channel.send("sudo -i -u postgres\n")
    time.sleep(1)

    if channel.recv_ready():
        recv = channel.recv(1024).decode("utf-8")
        if f"[sudo] password for {username}" in recv:
            sudo_password = getpass.getpass("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è sudo: ")
            channel.send(sudo_password + "\n")
            time.sleep(1)

    # –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ SQL-–∑–∞–ø—Ä–æ—Å–∞
    channel.send(sql_query + "\n")
    time.sleep(2)

    result = ""
    while channel.recv_ready():
        result += channel.recv(4096).decode("utf-8")
        time.sleep(0.3)

    # –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–∞
    match = re.search(r"^\s*(\d+)", result, re.MULTILINE)
    if match:
        status_code = match.group(1)
        status_text = status_map.get(status_code, f"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å—Ç–∞—Ç—É—Å: {status_code}")
        print(f"\n‚úÖ –°—Ç–∞—Ç—É—Å MPPS: {status_text} (–∫–æ–¥ {status_code})")
    else:
        print("\n‚ö†Ô∏è –°—Ç–∞—Ç—É—Å MPPS –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.")

    channel.close()
    client.close()

except Exception as e:
    print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
```
</details> 